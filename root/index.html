<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å‡ºè¡Œè®¡åˆ’</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="h-screen bg-[#343541] text-gray-100">
  <div id="root" class="h-full"></div>
  <script type="text/babel">
    const { useState } = React;

    const typeOptions = ['å‡ºå‘åœ°', 'å‡ºè¡Œ', 'é…’åº—', 'é¤å…', 'æ´»åŠ¨åœ°ç‚¹'];
    const travelModes = ['é«˜é“/åŠ¨è½¦', 'é£æœº', 'åœ°é“/å…¬äº¤', 'è‡ªé©¾/å‡ºç§Ÿè½¦'];

    const travelFieldMap = {
      'é«˜é“/åŠ¨è½¦': [
        { name: 'trainNumber', label: 'è½¦æ¬¡å·' },
        { name: 'departureStation', label: 'å‡ºå‘ç«™' },
        { name: 'entrance', label: 'è¿›ç«™å£' },
        { name: 'platform', label: 'ç«™å°å·' },
        { name: 'arrivalStation', label: 'åˆ°è¾¾ç«™' },
        { name: 'exit', label: 'å‡ºç«™å£' }
      ],
      'é£æœº': [
        { name: 'flightNumber', label: 'èˆªç­å·' },
        { name: 'departureAirport', label: 'å‡ºå‘æœºåœºåŠèˆªç«™æ¥¼' },
        { name: 'gate', label: 'ç™»æœºå£' },
        { name: 'arrivalAirport', label: 'åˆ°è¾¾æœºåœºåŠèˆªç«™æ¥¼' },
        { name: 'arrivalExit', label: 'å‡ºç«™å£' }
      ],
      'åœ°é“/å…¬äº¤': [
        { name: 'lineNumber', label: 'çº¿è·¯å·' },
        { name: 'boardStation', label: 'ä¸Šè½¦ç«™ç‚¹' },
        { name: 'dropStation', label: 'ä¸‹è½¦ç«™ç‚¹' },
        { name: 'exitNumber', label: 'å‡ºå£ç¼–å·' }
      ],
      'è‡ªé©¾/å‡ºç§Ÿè½¦': [
        { name: 'origin', label: 'å‡ºå‘åœ°' },
        { name: 'destination', label: 'ç›®çš„åœ°' },
        { name: 'driveDuration', label: 'é¢„è®¡è½¦ç¨‹' }
      ]
    };

    const hotelFields = [
      { name: 'checkIn', label: 'å…¥ä½æ—¶é—´', type: 'datetime-local' },
      { name: 'checkOut', label: 'é€€æˆ¿æ—¶é—´', type: 'datetime-local' },
      { name: 'room', label: 'æˆ¿å‹/å¤‡æ³¨' }
    ];

    const restaurantFields = [
      { name: 'cost', label: 'äººå‡æ¶ˆè´¹' },
      { name: 'note', label: 'ç‰¹è‰²/å¤‡æ³¨' }
    ];

    const activityFields = [
      { name: 'period', label: 'æ´»åŠ¨æ—¶é—´æ®µ' },
      { name: 'organizer', label: 'ä¸»åŠæ–¹/å¤‡æ³¨' }
    ];

    const linkIcons = {
      gaode: 'https://www.amap.com/favicon.ico',
      xhs: 'https://www.xiaohongshu.com/favicon.ico',
      meituan: 'https://www.meituan.com/favicon.ico'
    };

    function Modal({ children, onClose }) {
      return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-10">
          <div className="bg-[#343541] w-full max-w-lg rounded-lg shadow-xl p-6">
            <div className="flex justify-end">
              <button onClick={onClose} className="text-gray-400 hover:text-gray-200">âœ–</button>
            </div>
            {children}
          </div>
        </div>
      );
    }

    function TravelForm({ onAdd }) {
      const initialState = {
        type: 'å‡ºå‘åœ°',
        name: '',
        duration: '',
        links: { gaode: '', xhs: '', meituan: '' },
        travelMode: '',
        fields: {}
      };
      const [form, setForm] = useState(initialState);

      const handleChange = (field, value) => setForm(prev => ({ ...prev, [field]: value }));
      const handleLinkChange = (key, value) => setForm(prev => ({ ...prev, links: { ...prev.links, [key]: value } }));
      const handleFieldChange = (key, value) => setForm(prev => ({ ...prev, fields: { ...prev.fields, [key]: value } }));
      const handleTypeChange = e => setForm({ ...initialState, type: e.target.value });
      const handleTravelModeChange = e => setForm(prev => ({ ...prev, travelMode: e.target.value, fields: {} }));

      const handleSubmit = e => {
        e.preventDefault();
        const details = [];
        if (form.type === 'å‡ºè¡Œ' && form.travelMode) {
          travelFieldMap[form.travelMode].forEach(f => {
            if (form.fields[f.name]) details.push({ label: f.label, value: form.fields[f.name] });
          });
        } else {
          const map = {
            'é…’åº—': hotelFields,
            'é¤å…': restaurantFields,
            'æ´»åŠ¨åœ°ç‚¹': activityFields
          }[form.type];
          if (map) {
            map.forEach(f => {
              if (form.fields[f.name]) details.push({ label: f.label, value: form.fields[f.name] });
            });
          }
        }
        const card = {
          id: Date.now(),
          type: form.type,
          name: form.name,
          duration: form.duration,
          travelMode: form.type === 'å‡ºè¡Œ' ? form.travelMode : undefined,
          details,
          links: form.links
        };
        onAdd(card);
        setForm(initialState);
      };

      const renderDynamicFields = () => {
        if (form.type === 'å‡ºè¡Œ') {
          return (
            <>
              <div className="space-y-2">
                <label className="text-sm">å‡ºè¡Œæ–¹å¼</label>
                <div className="flex flex-wrap gap-4">
                  {travelModes.map(m => (
                    <label key={m} className="flex items-center gap-2">
                      <input
                        type="radio"
                        name="travelMode"
                        value={m}
                        checked={form.travelMode === m}
                        onChange={handleTravelModeChange}
                        className="h-4 w-4 text-[#10a37f] focus:ring-[#10a37f]"
                      />
                      <span>{m}</span>
                    </label>
                  ))}
                </div>
              </div>
              {form.travelMode && travelFieldMap[form.travelMode].map(f => (
                <div key={f.name} className="space-y-1">
                  <label className="text-sm">{f.label}</label>
                  <input
                    type={f.type || 'text'}
                    className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10a37f]"
                    value={form.fields[f.name] || ''}
                    onChange={e => handleFieldChange(f.name, e.target.value)}
                  />
                </div>
              ))}
            </>
          );
        }
        const maps = {
          'é…’åº—': hotelFields,
          'é¤å…': restaurantFields,
          'æ´»åŠ¨åœ°ç‚¹': activityFields
        }[form.type];
        if (maps) {
          return maps.map(f => (
            <div key={f.name} className="space-y-1">
              <label className="text-sm">{f.label}</label>
              <input
                type={f.type || 'text'}
                className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10a37f]"
                value={form.fields[f.name] || ''}
                onChange={e => handleFieldChange(f.name, e.target.value)}
              />
            </div>
          ));
        }
        return null;
      };

      return (
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-1">
            <label className="text-sm">äº‹é¡¹ç±»å‹</label>
            <select
              value={form.type}
              onChange={handleTypeChange}
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
            >
              {typeOptions.map(t => (
                <option key={t} value={t}>{t}</option>
              ))}
            </select>
          </div>
          <div className="space-y-1">
            <label className="text-sm">äº‹é¡¹åç§°</label>
            <input
              type="text"
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
              value={form.name}
              onChange={e => handleChange('name', e.target.value)}
              required
            />
          </div>
          <div className="space-y-1">
            <label className="text-sm">é¢„è®¡æ‰€éœ€æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
            <input
              type="number"
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
              value={form.duration}
              onChange={e => handleChange('duration', e.target.value)}
            />
          </div>
          <div className="space-y-1">
            <label className="text-sm">å¤–é“¾</label>
            <div className="space-y-2">
              <div className="flex items-center gap-2">
                <img src={linkIcons.gaode} alt="gaode" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="é«˜å¾·"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.gaode}
                  onChange={e => handleLinkChange('gaode', e.target.value)}
                />
              </div>
              <div className="flex items-center gap-2">
                <img src={linkIcons.xhs} alt="xhs" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="å°çº¢ä¹¦"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.xhs}
                  onChange={e => handleLinkChange('xhs', e.target.value)}
                />
              </div>
              <div className="flex items-center gap-2">
                <img src={linkIcons.meituan} alt="meituan" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="ç¾å›¢"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.meituan}
                  onChange={e => handleLinkChange('meituan', e.target.value)}
                />
              </div>
            </div>
          </div>
          {renderDynamicFields()}
          <button type="submit" className="w-full py-2 bg-[#10a37f] rounded text-white">ä¿å­˜</button>
        </form>
      );
    }

    function Card({ data, onDelete }) {
      const typeIcons = {
        'å‡ºå‘åœ°': 'ğŸ“',
        'å‡ºè¡Œ': 'ğŸš—',
        'é…’åº—': 'ğŸ¨',
        'é¤å…': 'ğŸ½ï¸',
        'æ´»åŠ¨åœ°ç‚¹': 'ğŸ‰'
      };
      return (
        <div className="flex gap-3">
          <div className="w-8 h-8 rounded-full bg-[#10a37f] flex items-center justify-center text-white flex-shrink-0">
            {typeIcons[data.type]}
          </div>
          <div className="flex-1 bg-[#40414f] rounded-lg p-4 space-y-2">
            <div className="flex justify-between items-center">
              <h3 className="font-semibold">{data.name}</h3>
              <button className="text-red-400 text-sm" onClick={() => onDelete(data.id)}>åˆ é™¤</button>
            </div>
            {data.duration && <div className="text-sm text-gray-400">{data.duration} åˆ†é’Ÿ</div>}
            {data.travelMode && <div className="text-sm">å‡ºè¡Œæ–¹å¼ï¼š{data.travelMode}</div>}
            {data.details.map((d, i) => (
              <div key={i} className="text-sm">{d.label}ï¼š{d.value}</div>
            ))}
            <div className="flex gap-2 pt-2">
              {Object.entries(data.links).map(([key, url]) => (
                url ? (
                  <a key={key} href={url} target="_blank" rel="noopener noreferrer">
                    <img src={linkIcons[key]} alt={key} className="w-5 h-5" />
                  </a>
                ) : null
              ))}
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [cards, setCards] = useState([]);
      const [open, setOpen] = useState(false);

      const addCard = card => setCards(prev => [...prev, card]);
      const deleteCard = id => setCards(prev => prev.filter(c => c.id !== id));

      return (
        <div className="flex flex-col h-full">
          <header className="bg-[#202123] p-4 text-center text-[#10a37f] font-bold">æ—…è¡Œè®¡åˆ’</header>
          <main className="flex-1 overflow-y-auto p-4 space-y-4">
            {cards.map(card => (
              <Card key={card.id} data={card} onDelete={deleteCard} />
            ))}
          </main>
          <div className="p-4 bg-[#40414f]">
            <button
              onClick={() => setOpen(true)}
              className="w-full py-2 px-3 rounded-md bg-[#10a37f] text-white"
            >
              æ–°å¢äº‹é¡¹
            </button>
          </div>
          {open && (
            <Modal onClose={() => setOpen(false)}>
              <TravelForm onAdd={card => { addCard(card); setOpen(false); }} />
            </Modal>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
