<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>出行计划</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="h-screen bg-[#343541] text-gray-100">
  <div id="root" class="h-full"></div>
  <script type="text/babel">
    const { useState } = React;

    const typeOptions = ['出发地', '出行', '酒店', '餐厅', '活动地点'];
    const travelModes = ['高铁/动车', '飞机', '地铁/公交', '自驾/出租车'];

    const travelFieldMap = {
      '高铁/动车': [
        { name: 'trainNumber', label: '车次号' },
        { name: 'departureStation', label: '出发站' },
        { name: 'entrance', label: '进站口' },
        { name: 'platform', label: '站台号' },
        { name: 'arrivalStation', label: '到达站' },
        { name: 'exit', label: '出站口' }
      ],
      '飞机': [
        { name: 'flightNumber', label: '航班号' },
        { name: 'departureAirport', label: '出发机场及航站楼' },
        { name: 'gate', label: '登机口' },
        { name: 'arrivalAirport', label: '到达机场及航站楼' },
        { name: 'arrivalExit', label: '出站口' }
      ],
      '地铁/公交': [
        { name: 'lineNumber', label: '线路号' },
        { name: 'boardStation', label: '上车站点' },
        { name: 'dropStation', label: '下车站点' },
        { name: 'exitNumber', label: '出口编号' }
      ],
      '自驾/出租车': [
        { name: 'origin', label: '出发地' },
        { name: 'destination', label: '目的地' },
        { name: 'driveDuration', label: '预计车程' }
      ]
    };

    const hotelFields = [
      { name: 'checkIn', label: '入住时间', type: 'datetime-local' },
      { name: 'checkOut', label: '退房时间', type: 'datetime-local' },
      { name: 'room', label: '房型/备注' }
    ];

    const restaurantFields = [
      { name: 'cost', label: '人均消费' },
      { name: 'note', label: '特色/备注' }
    ];

    const activityFields = [
      { name: 'period', label: '活动时间段' },
      { name: 'organizer', label: '主办方/备注' }
    ];

    const linkIcons = {
      gaode: 'https://www.amap.com/favicon.ico',
      xhs: 'https://www.xiaohongshu.com/favicon.ico',
      meituan: 'https://www.meituan.com/favicon.ico'
    };

    function Modal({ children, onClose }) {
      return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-10">
          <div className="bg-[#343541] w-full max-w-lg rounded-lg shadow-xl p-6">
            <div className="flex justify-end">
              <button onClick={onClose} className="text-gray-400 hover:text-gray-200">✖</button>
            </div>
            {children}
          </div>
        </div>
      );
    }

    function TravelForm({ onAdd }) {
      const initialState = {
        type: '出发地',
        name: '',
        duration: '',
        links: { gaode: '', xhs: '', meituan: '' },
        travelMode: '',
        fields: {}
      };
      const [form, setForm] = useState(initialState);

      const handleChange = (field, value) => setForm(prev => ({ ...prev, [field]: value }));
      const handleLinkChange = (key, value) => setForm(prev => ({ ...prev, links: { ...prev.links, [key]: value } }));
      const handleFieldChange = (key, value) => setForm(prev => ({ ...prev, fields: { ...prev.fields, [key]: value } }));
      const handleTypeChange = e => setForm({ ...initialState, type: e.target.value });
      const handleTravelModeChange = e => setForm(prev => ({ ...prev, travelMode: e.target.value, fields: {} }));

      const handleSubmit = e => {
        e.preventDefault();
        const details = [];
        if (form.type === '出行' && form.travelMode) {
          travelFieldMap[form.travelMode].forEach(f => {
            if (form.fields[f.name]) details.push({ label: f.label, value: form.fields[f.name] });
          });
        } else {
          const map = {
            '酒店': hotelFields,
            '餐厅': restaurantFields,
            '活动地点': activityFields
          }[form.type];
          if (map) {
            map.forEach(f => {
              if (form.fields[f.name]) details.push({ label: f.label, value: form.fields[f.name] });
            });
          }
        }
        const card = {
          id: Date.now(),
          type: form.type,
          name: form.name,
          duration: form.duration,
          travelMode: form.type === '出行' ? form.travelMode : undefined,
          details,
          links: form.links
        };
        onAdd(card);
        setForm(initialState);
      };

      const renderDynamicFields = () => {
        if (form.type === '出行') {
          return (
            <>
              <div className="space-y-2">
                <label className="text-sm">出行方式</label>
                <div className="flex flex-wrap gap-4">
                  {travelModes.map(m => (
                    <label key={m} className="flex items-center gap-2">
                      <input
                        type="radio"
                        name="travelMode"
                        value={m}
                        checked={form.travelMode === m}
                        onChange={handleTravelModeChange}
                        className="h-4 w-4 text-[#10a37f] focus:ring-[#10a37f]"
                      />
                      <span>{m}</span>
                    </label>
                  ))}
                </div>
              </div>
              {form.travelMode && travelFieldMap[form.travelMode].map(f => (
                <div key={f.name} className="space-y-1">
                  <label className="text-sm">{f.label}</label>
                  <input
                    type={f.type || 'text'}
                    className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10a37f]"
                    value={form.fields[f.name] || ''}
                    onChange={e => handleFieldChange(f.name, e.target.value)}
                  />
                </div>
              ))}
            </>
          );
        }
        const maps = {
          '酒店': hotelFields,
          '餐厅': restaurantFields,
          '活动地点': activityFields
        }[form.type];
        if (maps) {
          return maps.map(f => (
            <div key={f.name} className="space-y-1">
              <label className="text-sm">{f.label}</label>
              <input
                type={f.type || 'text'}
                className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10a37f]"
                value={form.fields[f.name] || ''}
                onChange={e => handleFieldChange(f.name, e.target.value)}
              />
            </div>
          ));
        }
        return null;
      };

      return (
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-1">
            <label className="text-sm">事项类型</label>
            <select
              value={form.type}
              onChange={handleTypeChange}
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
            >
              {typeOptions.map(t => (
                <option key={t} value={t}>{t}</option>
              ))}
            </select>
          </div>
          <div className="space-y-1">
            <label className="text-sm">事项名称</label>
            <input
              type="text"
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
              value={form.name}
              onChange={e => handleChange('name', e.target.value)}
              required
            />
          </div>
          <div className="space-y-1">
            <label className="text-sm">预计所需时间（分钟）</label>
            <input
              type="number"
              className="w-full bg-[#40414f] border border-gray-600 rounded px-3 py-2"
              value={form.duration}
              onChange={e => handleChange('duration', e.target.value)}
            />
          </div>
          <div className="space-y-1">
            <label className="text-sm">外链</label>
            <div className="space-y-2">
              <div className="flex items-center gap-2">
                <img src={linkIcons.gaode} alt="gaode" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="高德"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.gaode}
                  onChange={e => handleLinkChange('gaode', e.target.value)}
                />
              </div>
              <div className="flex items-center gap-2">
                <img src={linkIcons.xhs} alt="xhs" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="小红书"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.xhs}
                  onChange={e => handleLinkChange('xhs', e.target.value)}
                />
              </div>
              <div className="flex items-center gap-2">
                <img src={linkIcons.meituan} alt="meituan" className="w-5 h-5" />
                <input
                  type="url"
                  placeholder="美团"
                  className="flex-1 bg-[#40414f] border border-gray-600 rounded px-2 py-1"
                  value={form.links.meituan}
                  onChange={e => handleLinkChange('meituan', e.target.value)}
                />
              </div>
            </div>
          </div>
          {renderDynamicFields()}
          <button type="submit" className="w-full py-2 bg-[#10a37f] rounded text-white">保存</button>
        </form>
      );
    }

    function Card({ data, onDelete }) {
      const typeIcons = {
        '出发地': '📍',
        '出行': '🚗',
        '酒店': '🏨',
        '餐厅': '🍽️',
        '活动地点': '🎉'
      };
      return (
        <div className="flex gap-3">
          <div className="w-8 h-8 rounded-full bg-[#10a37f] flex items-center justify-center text-white flex-shrink-0">
            {typeIcons[data.type]}
          </div>
          <div className="flex-1 bg-[#40414f] rounded-lg p-4 space-y-2">
            <div className="flex justify-between items-center">
              <h3 className="font-semibold">{data.name}</h3>
              <button className="text-red-400 text-sm" onClick={() => onDelete(data.id)}>删除</button>
            </div>
            {data.duration && <div className="text-sm text-gray-400">{data.duration} 分钟</div>}
            {data.travelMode && <div className="text-sm">出行方式：{data.travelMode}</div>}
            {data.details.map((d, i) => (
              <div key={i} className="text-sm">{d.label}：{d.value}</div>
            ))}
            <div className="flex gap-2 pt-2">
              {Object.entries(data.links).map(([key, url]) => (
                url ? (
                  <a key={key} href={url} target="_blank" rel="noopener noreferrer">
                    <img src={linkIcons[key]} alt={key} className="w-5 h-5" />
                  </a>
                ) : null
              ))}
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [cards, setCards] = useState([]);
      const [open, setOpen] = useState(false);

      const addCard = card => setCards(prev => [...prev, card]);
      const deleteCard = id => setCards(prev => prev.filter(c => c.id !== id));

      return (
        <div className="flex flex-col h-full">
          <header className="bg-[#202123] p-4 text-center text-[#10a37f] font-bold">旅行计划</header>
          <main className="flex-1 overflow-y-auto p-4 space-y-4">
            {cards.map(card => (
              <Card key={card.id} data={card} onDelete={deleteCard} />
            ))}
          </main>
          <div className="p-4 bg-[#40414f]">
            <button
              onClick={() => setOpen(true)}
              className="w-full py-2 px-3 rounded-md bg-[#10a37f] text-white"
            >
              新增事项
            </button>
          </div>
          {open && (
            <Modal onClose={() => setOpen(false)}>
              <TravelForm onAdd={card => { addCard(card); setOpen(false); }} />
            </Modal>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
